START="$TACC_HADOOP/target/start"

USAGE="usage:
   `basename ${0}` [compile] [local CLASSNAME [ARGS...]]
   `basename ${0}` [jar] [cluster CLASSNAME [ARGS...]]"


FIRST_CMD=$1

case "$FIRST_CMD" in
  compile | jar)  # first command possibilities
    shift
    SECOND_CMD=$1
    shift

    if [[ -n $SECOND_CMD ]] ; then
      case "$SECOND_CMD" in
        local | cluster | local-scalding | cluster-scalding) ;;  # second command possibilities
        *)  # second command is invalid
          echo "$USAGE" >&2
          exit 1;;
      esac
    fi

    case "$FIRST_CMD" in
      compile)
        $TACC_HADOOP/sbt add-start-script-tasks start-script;;

      jar)
        $TACC_HADOOP/sbt assembly;;
    esac;;

  local | cluster | local-scalding | cluster-scalding)  # second command possibilities
    SECOND_CMD=$1
    shift ;;

  *)
    echo "$USAGE" >&2
    exit 1;;
esac


if [[ -n $SECOND_CMD ]] ; then
case "$SECOND_CMD" in
  local)
    $START "$@";;

  cluster)
    hadoop jar target/scala-2.9.2/tacc-hadoop-assembly.jar "$@";;

   local-scalding)
     $START com.twitter.scalding.Tool "$@" --local;;

   cluster-scalding)
     hadoop jar target/scala-2.9.2/tacc-hadoop-assembly.jar com.twitter.scalding.Tool "$@" --hdfs;;

esac
fi

